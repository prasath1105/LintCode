#### 题目：
小K被困在了一个山洞（山洞A）。
从山洞A出发有两条路，一条路需要走 x 千米，但是会回到山洞A；另一条路需要走 2 千米，会到达山洞B。
从山洞B出发有两条路，一条路需要走 y 千米，会到达山洞A；另一条路需要走 z 千米，会到达山洞的出口C。
小K有些健忘，记不得走过的路，所以每次在一个山洞都会随机选择一条路走，选择的概率相同。
问小K走出山洞的期望路程。

#### 分析

将这张地图表示成这样：（其中为了不失一般性，我们令A->B的距离为w，本题中w=2）
```
         x      y
        --> <----
        |  |    |
        <- A ---> B  ---> C
              w      z
```

什么是期望？
对于随机变量X，如果它的值可能是x1, x2, ..., xk
```
E = (p1 * x1 + p2 * x2 + ... + pk * xk) / (p1 + p2 + ... pk)
```

#### 解法1：

令从A出发走出山洞的期望Ea，从B出发走出山洞的期望Eb

从A出发，两种可能，一半概率是往左走（回到A，之后变数很多但目标仍然是出山洞），
一半概率是往右走（先到B，同样之后变数很多但目标仍然是出山洞）
````
Ea = 0.5 * (x + Ea) + 0.5 * (w + Eb)
```

从B出发，两种可能，一半概率是往左走（回到A，之后变数很多但目标仍然是出山洞），一半概率是往右走（直接出山洞）
```
Eb = 0.5 *(y + Ea) + 0.5 * z
```

解得 
```
Ea = 2 * x + 2 * w + z + y
Eb = w + x + y + z
```  



#### 解法2: 无限序列

每次从A出发，可以分类为三种结果：
a. 1/2的概率A->A    （循环）
b. 1/4的概率A->B->A （循环）
c. 1/4的概率离开山洞
也就是说，有总共3/4的概率是回到起始点，开始一个新的循环；另外1/4的概率就是结束循环。

那么从起点A开始，再回到起点A，一次循环的距离期望是什么呢？Ex = (1/2*(x) + 1/4*(w+y)) / (1/2+1/4)，
也就是说要如果从A走回循环点A的话，所需走路的平均距离就是Ex。

我们再考察结束循环的本质是什么。归纳起来，本质就是走了若干次循环（就是从A走回A，甭管是从哪条路回来的）后，再走A->B->C。仅此一种模式。
所以我们考虑走了0次循环、1次循环、2次循环。。。这几种情况。
1. 从A出发，经过0次循环，离开山洞的期望是：(1 * 1/4) * ABC                 (where ABC = w+z)
2. 从A出发，经过1次循环，离开山洞的期望是：(3/4 * 1/4) * (Ex + ABC)
3. 从A出发，经过2次循环，离开山洞的期望是：((3/4)^2 * 1/4) * (2*Ex + ABC)
4. 从A出发，经过3次循环，离开山洞的期望是：((3/4)^3 * 1/4) * (3*Ex + ABC)
...
从A出发，经过k次循环，离开山洞的期望是：((3/4)^k * 1/4) * (k*Ex + ABC)
（说明：(3/4)^k表示在A点走了k次循环的概率，1/4表示从A点直接走出山洞的概率，所以走出山洞的总期望就是上面全部加起来，其中k取到无限大。）
```
ans = ((3/4)^0 * 1/4) * (0*Ex + ABC) + ((3/4)^1 * 1/4) * (1*Ex + ABC) + ((3/4)^2 * 1/4) * (2*Ex + ABC) + ... + ((3/4)^k * 1/4) * (k*Ex + ABC)
    = 1/4 * sum( (3/4)^k * (k*Ex + ABC) ) , k=0,1,2,...
    = 1/4 * { [sum((3/4)^k * k*Ex)] + [sum((3/4)^k) * ABC ] }
    = 1/4 * {S + 4 * ABC}
    = 1/4 *S + ABC
```
令 q = 3/4 
则S可以表达为一个“等差等比数列”，怎么解可以参见高一数学课本。
```
 S = q^0 * 0Ex + q^1 * 1Ex + q^2 * 2Ex + ... + q^k * kEx            
qS =             q^1 * 0Ex + q^2 * 1Ex + ... + q^k * (k-1)Ex + q^(k+1) * kEx

(1-q)S = Ex * (q^1 + q^2 + q^3 +...+q^k) - q^(k+1) * k*Ex

     S = Ex * 1/(1-q) * q/(1-q)
       = Ex * 4 * 3
       = Ex * 12
       = 8 x + 4 w+ 4 y

ans = 1/4 *S + ABC
    = (2 x + w + y) + (w + z) = 2 x + 2 w + y +z
```
